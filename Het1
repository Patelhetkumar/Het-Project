def parse_inventory(file_path):
    """Parse inventory-prod.yaml to extract actual cells for servers, avoiding duplicates."""
    with open(file_path, "r") as file:
        inventory = yaml.safe_load(file)

    inventory_data = {}
    processed_hosts = set()

    all_groups = inventory.get('all', {}).get('children', {})

    for group, group_data in all_groups.items():
        if not isinstance(group_data, dict):
            continue  # Skip non-dict entries

        if "hosts" in group_data and isinstance(group_data["hosts"], dict):
            for server, server_info in group_data["hosts"].items():
                if isinstance(server_info, dict):
                    # Normalize cell names before adding
                    cells = {normalize_cell(c) for c in server_info.get("cells", [])}

                    if server not in processed_hosts:
                        inventory_data[server] = cells
                        processed_hosts.add(server)

    return inventory_data
